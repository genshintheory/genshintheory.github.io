<!DOCTYPE html>
<html>
  
  <head>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script> 
    $(function(){
      $("#includedContent").load("header.html"); 
    });
    </script> 
    
    <link rel="stylesheet" href="css/table.css">
    <link rel="icon" type="image/x-icon" href="img/Site-favicon.ico"/>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

<title>Artifacts</title>

  </head>
  
<body>
  <div id="includedContent"></div>

<h2>Substats and optimization</h2>
<p>We will assume 5 star artifacts.
  Each artifact has 4 different substats.
  These are usually drawn randomly (some may initially start with 2 or 3 substats but by level 20 will have 4).
  We assume each artifact starts with 4 substats at level 0.
</p><p>
  When leveling an artifact every 4 levels, one of these substats (chosen randomly) will increase.
  The increase amount depends on what tier that substat was drawn in.
  Each substat can be drawn from 4 tiers, each tier giving different amounts of that substat.
  Here we will assume each substat is drawn from the highest tier.
</p><p>
  Substats include hp, atk, def, hp%, atk%, def%, ER, EM, CR, CD (10 different substats).
  Of these usually CR and CD are most valuable for increasing dps.
  The crit value is defined as \(CV = 2*CR + CD\).
  This is defined as usually CR and CD are distributed in a 1:2 ratio within the game.
</p><p>
  So as far as optimization goes, given that the search space is small and finite,
  brute force can be used to find the optimal combination of substats to maximize damage.
  There are 10 different substats so \(\binom{10}{4} = 210\) different substat combinations on a main piece.
  There are then \(\binom{8}{3} = 56\) ways the substats can be increased when leveling to level 20.
  In all there are \(210*56=11760\) possible lv20 artifacts (assuming they start with 4 substats at max tier at lv0).
  Brute force on 10k possibilities is nothing for modern computers.
  It can even be done in a second.
</p><p>
  But usually one tries to maximize the amount of crit on the substats.
  For the flower, feather, sands, goblet, each will have 2 substats that max out crit.
  Each will have 2 other substats which can be atk, er, em, hp, or def depending on what the unit needs.
  Then lastly the circlet will usually be crit on the main stat with 1 crit substat (that is maxed out) and 3 other substats.
  It can be a crit rate or crit damage circlet.
  If it is a crit dmg circlet, one will usually want to max out crit rate on the substat and vice versa.
</p><p>
  For a general ATK scaling character, usually atk, atk% are most important as substats.
  For characters that focus more on their bursts, ER can also be important.
  For characters that have special scaling with em, hp, or def, those substats can be important too.
</p><p>
  At max tier, cr comes in increments of 3.89%, and cd comes in increments of 7.77%.
  A single piece can level up a substat up to 5 times.
  For example, if cr is leveled 3 times and cd 2 times, the piece will have 
  3*3.89% = 11.67% cr and 2*7.77% = 15.54% cd.
  Sometimes we say we have 3 substats of cr and 2 substats of cd,
  where we treat 'substat' as a unit of measure.
  For four of the pieces, substats can be increased up to 20 times (we have 20 substats).
  The question is how to distribute those 20 times between cr and cd (how to distribute 20 substats between cr, cd).
</p><p>
  This depends on other things like the weapon, the circlet, whether the character ascends with crit,
  and other sources of crit buffs (like Gorou, Blizzard, etc.).
</p><p>
  But in general, the average crit multiplier is 1+rd 
  so you want to maximize the product rd of crit rate r and crit damage d.
</p><p>
  In total, one artifact piece starts with 4 substats and can level up 5 times,
  so it will have a total of 9 substats.
  For the five pieces, there are a total of 45 substats.
</p>

<h2>Vanilla character</h2>
<p>Suppose the character does not have crit on the weapon, does not ascend with crit, or get crit buffs from any external source.
  That is, suppose their only source of crit is from artifacts.
  Most characters start with 50% cd and 5% cr.
  What is the optimal choice of crit on the artifacts?
</p><p>
  Suppose each non-circlet piece gives 3.89% cr and 7.77% cd at level 0.
  We then need to allocate 5*4=20 substats between cr and cd.
  We also have to choose between cr and cd circlet.
  A cr circlet gives 31.1% cr and up to 7.77*6=46.62% cd.
  A cd circlet gives 62.2% cd and up to 3.89*6=23.34% cr.
</p><p>
  Suppose we use a cr circlet, so that
  $$r = 5+3.89*(4+x)+31.1 = 51.66+3.89x$$
  and
  $$d = 50+7.77*(4+y)+46.62 = 127.7+7.77y$$
  where
  $$g = x + y - 20 = 0$$
  We want to maximize the product
  $$f = rd = c + 401.3982 y + 496.753 x + 30.2253 xy$$
  This is a constrained optimization problem where x, y take on nonnegative integer values.
</p><p>
  Using lagrange multipliers gives
  $$\partial_x(f + \lambda g) = 496.753 + 30.2253 y + \lambda = 0$$
  and
  $$\partial_y(f + \lambda g) = 401.3982 + 30.2253 x + \lambda = 0$$
  Solving gives
  $$\begin{align}
  -\lambda &= 496.753 + 30.2253 y = 401.3982 + 30.2253 x \\
  95.3548 &= 30.2253 (x - y) \\
  x &= y + 3.1548007795
  \end{align}$$
</p><p>
  Substituting into the constraint g gives
  $$2y + 3.1548007795 - 20 = 0$$
  or y = 8.42259961025.
  Then x = 11.57740038975.
</p><p>
  The optimal cr and cd are then
  r = 96.7%
  and d = 193.14%.
  In other words, r and d are distributed in a 1 to 2 ratio.
  This has already been derived in <a href='optimization.html'>optimization</a>.
</p><p>
  The expected crit multiplier is then
  $$1+rd = 1+.967*1.9314 = 2.8676638$$
  It is similar to having 100% cr and 200% cd.
  This is achievable for every vanilla character without the use of crit weapons,
  assuming optimal artifacts.
  Of course, in practice it is very hard to get optimal artifacts (2 crit on each piece at max tier, with all rolls going into crit).
  The odds are quite low (assuming that the artifact rolls are not rigged manually by the game).
</p>

  </body>
</html>